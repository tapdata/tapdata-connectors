# StarRocks 连接器新增功能

## 概述

为 StarRocks 连接器新增了三个重要的配置项，用于更精细地控制数据写入行为：

1. **刷新大小阈值 (flushSizeMB)**: 控制本地缓冲数据的大小阈值
2. **刷新超时阈值 (flushTimeoutSeconds)**: 控制数据刷新的时间阈值  
3. **每小时写入限制 (hourlyLimitGB)**: 控制每小时的数据写入量

## 配置说明

### 1. 刷新大小阈值 (flushSizeMB)
- **类型**: Integer
- **默认值**: 100 (MB)
- **范围**: 1-1024 MB
- **说明**: 当本地缓冲的数据达到此大小时，会触发数据刷新到 StarRocks
- **优先级**: 高于通用的写入条数配置

### 2. 刷新超时阈值 (flushTimeoutSeconds)
- **类型**: Integer  
- **默认值**: 300 (秒)
- **范围**: 1-3600 秒
- **说明**: 即使数据量未达到大小阈值，超过此时间也会强制刷新数据
- **优先级**: 高于通用的超时配置

### 3. 每小时写入限制 (hourlyLimitGB)
- **类型**: Integer
- **默认值**: 0 (不限制)
- **范围**: 0-10000 GB
- **说明**: 限制每小时的数据写入量，0表示不限制。超过限制时会暂停写入直到下个小时

## 工作原理

### 数据缓冲和刷新机制
1. 数据首先写入到本地缓冲区
2. 当满足以下任一条件时触发刷新：
   - 缓冲数据大小达到 `flushSizeMB` 阈值
   - 距离上次刷新时间超过 `flushTimeoutSeconds` 阈值
   - 原有的缓冲区满或数据列变化等条件

### 流量控制机制
1. 在每次写入数据前检查当前小时的写入量
2. 如果加上当前数据会超过 `hourlyLimitGB` 限制：
   - 先刷新当前缓冲的数据
   - 暂停写入直到下个小时开始
3. 每个自然小时重置计数器

## 配置示例

```json
{
  "flushSizeMB": 200,           // 200MB 触发刷新
  "flushTimeoutSeconds": 600,   // 10分钟超时刷新
  "hourlyLimitGB": 50          // 每小时最多写入50GB
}
```

## 使用建议

### 性能优化
- 增大 `flushSizeMB` 可以减少网络请求次数，提高吞吐量
- 减小 `flushTimeoutSeconds` 可以降低数据延迟
- 根据网络带宽和 StarRocks 集群性能调整参数

### 流量控制
- 设置 `hourlyLimitGB` 可以避免突发流量对 StarRocks 集群造成冲击
- 适合在有明确容量规划的生产环境中使用

### 监控建议
- 监控每小时的实际写入量
- 观察刷新频率和数据延迟
- 根据业务需求调整参数

## 注意事项

1. 新配置的优先级高于通用的写入条数和超时配置
2. 流量控制基于内存计数，重启后会重置
3. 时间控制基于自然小时（如 14:00-15:00）
4. 当触发流量限制时，会有日志记录等待时间
